<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
      <title>Add New Athlete - DARES</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://github.com/user-attachments/assets/082f94ac-1590-444d-8c1d-f431899d4892">
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <script src="src/add-athlete.js" defer></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    * {
      font-family: 'Inter', sans-serif;
    }
    
    .nav-glass {
      backdrop-filter: blur(10px);
      background: rgba(0, 0, 0, 0.9);
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .card {
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.3s ease;
    }
    
    .page-bg {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      min-height: 100vh;
    }
  </style>
</head>
<body class="page-bg">
  
  <!-- Navigation -->
  <nav class="nav-glass">
    <div class="container mx-auto px-6 py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
                          <img src="https://github.com/user-attachments/assets/082f94ac-1590-444d-8c1d-f431899d4892" alt="DSNC Logo" class="h-8 w-8 text-white">
                          <span class="text-xl font-bold text-white">DARES</span>
        </div>
        <div class="flex space-x-4">
          <button onclick="window.location.href='index.html'" class="px-6 py-2 text-white hover:text-yellow-400 transition-colors font-semibold">
            <i class="fas fa-chart-line mr-2"></i>Test Entry
          </button>
          <button onclick="window.location.href='index.html'" class="px-6 py-2 text-white hover:text-yellow-400 transition-colors font-semibold">
            <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
          </button>
          <button onclick="logout()" class="px-6 py-2 bg-red-600 hover:bg-red-700 text-white rounded-full transition-all font-semibold">
            <i class="fas fa-sign-out-alt mr-2"></i>Logout
          </button>
        </div>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-6 py-12">
    <!-- Role Check Warning -->
    <div id="roleWarning" class="hidden max-w-2xl mx-auto mb-8">
      <div class="bg-yellow-100 border border-yellow-400 text-yellow-800 p-4 rounded-xl">
        <div class="flex items-center">
          <i class="fas fa-exclamation-triangle mr-3 text-xl"></i>
          <div>
            <h3 class="font-semibold">Access Restricted</h3>
            <p>You need <strong>Admin role or higher</strong> to add new athletes. Please contact an administrator to upgrade your account.</p>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center mb-12 pt-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-4">
        <i class="fas fa-user-plus mr-3 text-blue-600"></i>Add New Athlete
      </h1>
      <p class="text-xl text-gray-600">Register a new athlete to the performance tracking system</p>
    </div>
    
    <div class="max-w-2xl mx-auto">
      <div class="card rounded-2xl p-8 shadow-lg">
        <form id="addAthleteForm" class="space-y-6">
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="fullName" class="block font-semibold text-gray-700 mb-2">
                <i class="fas fa-user mr-2"></i>Full Name
              </label>
              <input type="text" id="fullName" required placeholder="Enter full name" 
                     class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
            </div>
            
            <div>
              <label for="dob" class="block font-semibold text-gray-700 mb-2">
                <i class="fas fa-calendar mr-2"></i>Date of Birth
              </label>
              <input type="date" id="dob" required 
                     class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
            </div>
          </div>
          
          <div class="grid md:grid-cols-2 gap-6">
            <div>
              <label for="gender" class="block font-semibold text-gray-700 mb-2">
                <i class="fas fa-venus-mars mr-2"></i>Gender
              </label>
              <input type="text" id="gender" required placeholder="e.g., Male, Female" 
                     class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
            </div>
            
            <div>
              <label for="sport" class="block font-semibold text-gray-700 mb-2">
                <i class="fas fa-running mr-2"></i>Primary Sport
              </label>
              <input type="text" id="sport" required placeholder="e.g., Football, Basketball" 
                     class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
            </div>
          </div>
          
          <div>
            <label for="contact" class="block font-semibold text-gray-700 mb-2">
              <i class="fas fa-phone mr-2"></i>Contact Information
            </label>
            <input type="text" id="contact" required placeholder="Phone number or email" 
                   class="w-full p-4 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all" />
          </div>
          
          <button type="submit" class="btn-primary w-full py-4 text-white rounded-xl font-semibold text-lg">
            <i class="fas fa-plus mr-2"></i>Add Athlete to System
          </button>
        </form>
      </div>
      
      <!-- Success/Error Messages -->
      <div class="text-center mt-8">
        <p id="successMessage" class="hidden bg-green-100 text-green-800 p-4 rounded-xl border border-green-200 text-lg font-semibold">
          <i class="fas fa-check-circle mr-2"></i>Athlete added successfully! Redirecting to dashboard...
        </p>
        <p id="errorMessage" class="hidden bg-red-100 text-red-800 p-4 rounded-xl border border-red-200 text-lg font-semibold">
          <i class="fas fa-exclamation-circle mr-2"></i>Failed to add athlete. Please try again.
        </p>
        
        <button id="goBackBtn" class="btn-primary px-8 py-3 rounded-xl mt-4 font-semibold">
          <i class="fas fa-arrow-left mr-2"></i>Go Back to Dashboard
        </button>
      </div>
    </div>
  </main>
  
  <script>
    const API_BASE_URL = 'https://fitness-app-production-b5bb.up.railway.app';
    
    function logout() {
      localStorage.removeItem('token');
      localStorage.removeItem('userRole');
      window.location.href = '/login.html';
    }

    // Check user role on page load
    async function checkUserRole() {
      const userRole = localStorage.getItem('userRole') || 'Athlete';
      const roleHierarchy = {
        'Athlete': 1,
        'Tester': 2, 
        'Admin': 3,
        'Super Admin': 4
      };
      
      let hasPermission = true;
      
      if ((roleHierarchy[userRole] || 1) < 2) {
        // For athletes, check if they're adding their first athlete
        if (userRole === 'Athlete') {
          try {
            const token = localStorage.getItem('token');
            const athleteCheckRes = await fetch(`${API_BASE_URL}/api/athletes`, {
              headers: { Authorization: `Bearer ${token}` }
            });
            if (athleteCheckRes.ok) {
              const existingAthletes = await athleteCheckRes.json();
              if (existingAthletes && existingAthletes.length > 0) {
                hasPermission = false;
                // Update warning message for athletes who already have athletes
                document.querySelector('#roleWarning div p').textContent = 
                  'You can only add one athlete. Athletes already exist in the system.';
              }
            }
          } catch (err) {
            console.error('Error checking existing athletes:', err);
          }
        } else {
          hasPermission = false;
          // Update warning message for non-athletes
          document.querySelector('#roleWarning div p').textContent = 
            'You need Tester role or higher to add new athletes. Please contact an administrator to upgrade your account.';
        }
      }
      
      if (!hasPermission) {
        // User doesn't have permission
        document.getElementById('roleWarning').classList.remove('hidden');
        document.getElementById('addAthleteForm').style.opacity = '0.5';
        document.getElementById('addAthleteForm').style.pointerEvents = 'none';
      }
      
      // Add role indicator
      const roleIndicator = document.createElement('div');
      roleIndicator.className = 'fixed bottom-4 left-4 bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-semibold z-50 shadow-lg';
      roleIndicator.textContent = `Role: ${userRole}`;
      document.body.appendChild(roleIndicator);
    }

    // Run role check when page loads
    checkUserRole();
  </script>
</body>
</html>
