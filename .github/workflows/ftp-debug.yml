name: FTP Debug Test

on:
  workflow_dispatch:

jobs:
  debug:
    name: Debug FTP Connection
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4
      
    - name: Install FTP tools
      run: |
        sudo apt-get update
        sudo apt-get install -y ftp lftp
        
    - name: Check Directory Structure and Files
      run: |
        echo "ğŸ” Testing FTP connection and checking app-dsnc-in directory..."
        lftp -c "
        set ftp:ssl-allow no;
        open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_HOST }};
        echo '=== FTP ROOT ===';
        pwd;
        ls -la;
        echo '=== PUBLIC_HTML DIRECTORY ===';
        cd public_html;
        pwd;
        ls -la;
        echo '=== APP-DSNC-IN DIRECTORY ===';
        cd app-dsnc-in 2>/dev/null && pwd && ls -la || echo 'app-dsnc-in directory does not exist';
        quit
        "
        
    - name: List Local Files to Upload
      run: |
        echo "ğŸ“ Files in ./public/ that should be uploaded:"
        find ./public/ -type f | head -10
        echo "ğŸ“Š Total files in ./public/:"
        find ./public/ -type f | wc -l

    - name: Upload a single test file
      run: |
        echo "TEST FILE - $(date)" > test-upload.txt
        echo "ğŸ“ Uploading test file..."
        lftp -c "
        set ftp:ssl-allow no;
        open -u ${{ secrets.FTP_USERNAME }},${{ secrets.FTP_PASSWORD }} ${{ secrets.FTP_HOST }};
        cd public_html/app-dsnc-in/;
        put test-upload.txt;
        ls -la test-upload.txt;
        quit
        "
        echo "âœ… Test file upload completed!" 